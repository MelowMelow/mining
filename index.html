<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <title>Anti-Utopia Mining Game</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <!-- Your existing HTML elements remain the same until the scripts -->

  <script src="script.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      if (window.Telegram && window.Telegram.WebApp) {
        const tgWebApp = window.Telegram.WebApp;
        tgWebApp.ready(); // Initialize the Telegram WebApp
        
        const initData = tgWebApp.initData;
        if (!initData) {
          console.error('No init data available');
          return;
        }

        try {
          const response = await fetch('/api/authenticate', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ initData })
          });

          const data = await response.json();
          if (data.success) {
            console.log('Authentication successful', data);
            
            // Hide the Telegram Login Widget
            const widgetContainer = document.getElementById('telegram-widget-container');
            if (widgetContainer) {
              widgetContainer.style.display = 'none';
            }

            // Store user data and ID
            localStorage.setItem('userData', JSON.stringify(data.user));
            localStorage.setItem('userId', data.telegram_id);
            
            // Initialize the userId variable in script.js
            if (typeof initializeUserId === 'function') {
              initializeUserId(data.telegram_id);
            }

            console.log(data.isNewUser ? 'New user registered' : 'Existing user logged in');
          } else {
            console.error('Authentication failed:', data.error);
			alert.('Authentication fail');
          }
        } catch (error) {
          console.error('Error during authentication:', error);
		  
        }
      } else {
        console.error('Telegram WebApp not available');
		alert.('Telegram WebApp not available');
      }
    });
  </script>
</body>
</html>